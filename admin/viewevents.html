<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Events - EventManager</title>
    <link rel="stylesheet" href="adminhome.css">
    <style>
        /* No Events Message */
.no-events-message {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    color: #555;
    padding: 20px;
}

        .loading-ring {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>EventManager</h1>
                <p>Admin Dashboard</p>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="adminhome.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            Home
                        </a>
                    </li>
                    <li>
                        <a href="addevents.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
                            Add Events
                        </a>
                    </li>
                    <li>
                        <a href="viewevents.html" class="nav-link active">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                            View Events
                        </a>
                    </li>
                    <li>
                        <a href="viewusers.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            View Users
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a onclick="logout" href="https://us-east-18ayp9fozb.auth.us-east-1.amazoncognito.com/login?client_id=4u8498hkb3nljv9c343g9ktgk2&redirect_uri=https://master.d1p222prhjubuw.amplifyapp.com/callback.html&response_type=token&scope=aws.cognito.signin.user.admin+email+openid+phone+profile" class="logout-btn" id="logoutBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    Logout
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <h2>All Events</h2>
            <div class="events-filters">
                <input type="text" placeholder="Search events..." class="search-input">
                <select class="filter-select">
                    <option value="all">All Events</option>
                    <option value="upcoming">Upcoming</option>
                    <option value="completed">Completed</option>
                </select>
            </div>
            <div class="loading-ring" id="loading"></div>
            <table class="events-table">
                <thead>
                    <tr>
                        <th>Event Name</th>
                        <th>Date & Time</th>
                        <th>Location</th>
                        <th>Capacity</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- <tr>
                        <td>Tech Conference 2024</td>
                        <td>Apr 15, 2024 09:00</td>
                        <td>Convention Center</td>
                        <td>150/200</td>
                        <td><span class="status upcoming">Upcoming</span></td>
                        <td>
                            <button class="btn-icon" title="Edit">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                            </button>
                            <button class="btn-icon delete" title="Delete">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                            </button>
                        </td>
                    </tr> -->
                </tbody>
            </table>
        </main>
    </div>
    <script>
        

// Search Functionality
const searchInput = document.querySelector('.search-input');
searchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.events-table tbody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' :  'none';
    });
});

// Event Status Filter
const filterSelect = document.querySelector('.filter-select');
filterSelect.addEventListener('change', (e) => {
    const filterValue = e.target.value;
    const rows = document.querySelectorAll('.events-table tbody tr');

    rows.forEach(row => {
        const status = row.querySelector('.status').textContent.toLowerCase();
        if (filterValue === 'all' || status === filterValue) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});

// Delete Event Handler
document.addEventListener("click", async function (event) {
    if (event.target.classList.contains("delete")) {
        const row = event.target.closest("tr");
        const eventId = row.dataset.eventId; // ✅ Correct way to access eventId

        console.log("Event ID:", eventId); // Debugging

        if (!eventId) {
            alert("Error: eventId not found!");
            return;
        }

        if (confirm("Are you sure you want to delete this event?")) {
            try {
                const response = await fetch(`https://3q516gt0rb.execute-api.us-east-1.amazonaws.com/stage1?eventId=${eventId}`, {
                    method: "DELETE"
                });

                const result = await response.json();
                console.log("result",result);
                if (response.ok) {
                    row.remove(); // ✅ Remove the row from the UI
                } else {
                    alert("Failed to delete event: " + result.message);
                }
            } catch (error) {
                console.error("Error deleting event:", error);
            }
        }
    }
});







    </script>

    <!--AWS SDK for javascript-->
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.834.0.min.js"></script>

<!-- <script src="api.js"></script> -->

<script src="../js/main.js"></script>

   

<script>
function logout() {
    localStorage.removeItem("access_token");
    localStorage.removeItem("id_token");
    window.location.href = "https://master.d1p222prhjubuw.amplifyapp.com/";
}
</script>

<!-- ----------------------------------to fetch the events-------------------------------------> 
<script>

document.addEventListener("DOMContentLoaded", function () {
    fetchEvents();
});

async function fetchEvents() {
    try {
        document.getElementById("loading").style.display = "block";
        const response = await fetch("https://3q516gt0rb.execute-api.us-east-1.amazonaws.com/stage1"); // Replace with actual API endpoint
        const data = await response.json();  // Convert HTTP response to JSON
        
        if (data.body) {
            const events = JSON.parse(data.body);  // Parse the 'body' string
            populateTable(events);  // Call function to display events
        } else {
            console.error("Unexpected API response format:", data);
        }
    } catch (error) {
        console.error("Error fetching events:", error);
    }
    finally {
            document.getElementById("loading").style.display = "none"; // Hide loading ring
        }
}



function populateTable(events) {
    const tableBody = document.querySelector(".events-table tbody");
    tableBody.innerHTML = "";

    if (!Array.isArray(events) || events.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="6" class="no-events-message">
                    No events to display
                </td>
            </tr>
        `;
        return;
    }

    const currentDate = new Date(); // Get today's date

    events.forEach(event => {
        const eventDateTime = new Date(`${event.date} ${event.time}`); // Convert event date & time to Date object
        let statusClass = "upcoming"; // Default status
        let statusText = "Upcoming";

        if (eventDateTime < currentDate) {
            statusClass = "completed";
            statusText = "Completed";
        }

        const row = document.createElement("tr");
        row.dataset.eventId = event.eventId;

        row.innerHTML = `
            <td>${event.title || "N/A"}</td>
            <td>${event.date || "N/A"} ${event.time || ""}</td>
            <td>${event.location || "N/A"}</td>
            <td>${event.capacity || "0"}</td>
            <td><span class="status ${statusClass}">${statusText}</span></td>
            <td>
                <button class="btn-icon" title="Edit">✏️</button>
                <button class="btn-icon delete" title="Delete">🗑️</button>
            </td>
        `;

        tableBody.appendChild(row);
    });
}



</script>
</body>
</html>