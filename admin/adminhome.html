<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - EventManager</title>
    <link rel="stylesheet" href="adminhome.css">
    <style>
        .loading-ring {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>EventManager</h1>
                <p>Admin Dashboard</p>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    
                    <li>
                        <a href="adminhome.html" class="nav-link active">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            Home
                        </a>
                    </li>
                    <li>
                        <a href="addevents.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
                            Add Events
                        </a>
                    </li>
                    <li>
                        <a href="viewevents.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                            View Events
                        </a>
                    </li>
                    <li>
                        <a href="viewusers.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            View Users
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                 <a onclick="logout" href="https://us-east-18ayp9fozb.auth.us-east-1.amazoncognito.com/logout?client_id=4u8498hkb3nljv9c343g9ktgk2&redirect_uri=https://127.0.0.1:5500/callback.html&response_type=token&scope=aws.cognito.signin.user.admin+email+openid+phone+profile" class="logout-btn" id="logoutBtn">
                    <!-- <button class="logout-btn" onclick="logout()"> -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    Logout</button>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <h2>Welcome,<span id="userName"></span></h2>
            <h2>Dashboard Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                    </div>
                    <div class="stat-details">
                        <h3>Total Events</h3>
                        <!-- <p>24</p> -->
                        <p id="totalEvents">Loading...</p>
                        
                        
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    </div>
                    <div class="stat-details">
                         <h3>Total Users</h3>
                        <!-- <p>156</p> --> 
                        <p id="totalUsers">Loading...</p>

                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    </div>
                    <div class="stat-details">
                        <h3>Registrations</h3>
                        <!-- <p>342</p> -->
                        
                        <p id="totalRegistrations">Loading...</p>
                        
                        
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    </div>
                    <div class="stat-details">
                        <h3>Upcoming Events</h3>
                        <!-- <p>8</p> -->
                        
                        <p id="upcomingEvents">Loading...</p>
                        
                    </div>
                </div>
            </div>
            <div class="recent-events">
                <h3>Recent Events</h3>
                <div class="loading-ring" id="loading"></div>
                <table>
                    <thead>
                        <tr>
                            <th>Event Name</th>
                            <th>Date</th>
                            <th>Location</th>
                            <th>Registrations</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentEventsTable">
                        <!-- Data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
            
        </main>
    </div>
    <script src="adminhome.js"></script>

<!--AWS SDK for javascript-->
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.834.0.min.js"></script>

<!-- <script src="api.js"></script> -->

<script src="../js/main.js"></script>

   

<script>
function logout() {
    localStorage.removeItem("access_token");
    localStorage.removeItem("id_token");
    window.location.href = "http://127.0.0.1:5500/index.html";
}

    const eventsTableBody = document.getElementById("recentEventsTable");

    async function fetchDashboardStats() {
    try {
        document.getElementById("loading").style.display = "block";
        const response = await fetch("https://3q516gt0rb.execute-api.us-east-1.amazonaws.com/stage3/admin/recent-events");
        const data = await response.json();

        console.log("Raw API Response:", data); // Debugging output

        // Ensure `body` is parsed properly
        const stats = typeof data.body === "string" ? JSON.parse(data.body) : data.body;

        if (!stats || typeof stats !== "object") {
            throw new Error("Invalid API response format");
        }

        // Update dashboard statistics
        document.getElementById("totalEvents").textContent = stats.totalEvents || 0;
        document.getElementById("totalUsers").textContent = stats.totalUsers || 0;
        document.getElementById("totalRegistrations").textContent = stats.totalRegistrations || 0;
        document.getElementById("upcomingEvents").textContent = stats.upcomingEvents || 0;

        // Update recent events table
        const eventsTableBody = document.getElementById("recentEventsTable");
        eventsTableBody.innerHTML = ""; // Clear previous data

        if (Array.isArray(stats.recentEvents)) {
            stats.recentEvents.forEach(event => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${event.title}</td>
                    <td>${new Date(event.date).toLocaleDateString()}</td>
                    <td>${event.location}</td>
                    <td>${event.registrationCount}/${event.capacity}</td>
                    <td><span class="status ${event.status.toLowerCase()}">${event.status}</span></td>
                `;
                eventsTableBody.appendChild(row);
            });
        }

    } catch (error) {
        console.error("Error fetching dashboard stats:", error);
    }
    finally {
            document.getElementById("loading").style.display = "none"; // Hide loading ring
        }
}

// Call the function when the page loads
document.addEventListener("DOMContentLoaded", fetchDashboardStats);





</script>


</body>
</html>