<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Users - EventManager</title>
    <link rel="stylesheet" href="adminhome.css">
    <style>
        .loading-ring {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>EventManager</h1>
                <p>Admin Dashboard</p>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="adminhome.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            Home
                        </a>
                    </li>
                    <li>
                        <a href="addevents.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
                            Add Events
                        </a>
                    </li>
                    <li>
                        <a href="viewevents.html" class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                            View Events
                        </a>
                    </li>
                    <li>
                        <a href="viewusers.html" class="nav-link active">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            View Users
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a onclick="logout" href="https://us-east-18ayp9fozb.auth.us-east-1.amazoncognito.com/logout?client_id=4u8498hkb3nljv9c343g9ktgk2&redirect_uri=https://127.0.0.1:5500/callback.html&response_type=token&scope=aws.cognito.signin.user.admin+email+openid+phone+profile" class="logout-btn" id="logoutBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    Logout
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <h2>Registered Users</h2>
            <div class="users-filters">
                <input type="text" placeholder="Search users..." class="search-input">
            </div>
            <div class="loading-ring" id="loading"></div>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Registered Events</th>
                        <th>Join Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- <tr>
                        <td>John Doe</td>
                        <td>john@example.com</td>
                        <td>3</td>
                        <td>Mar 15, 2024</td>
                        <td>
                            <button class="btn-icon" title="View Details">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            </button>
                        </td>
                    </tr> -->
                </tbody>
            </table>
        </main>
    </div>
    <script>
        

// Search Functionality
const searchInput = document.querySelector('.search-input');
searchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.users-table tbody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
});

// View User Details Handler
const viewButtons = document.querySelectorAll('.btn-icon');
viewButtons.forEach(button => {
    button.addEventListener('click', () => {
        const row = button.closest('tr');
        const name = row.cells[0].textContent;
        const email = row.cells[1].textContent;
        alert(`User Details:\nName: ${name}\nEmail: ${email}`);
        // Here you would typically show a modal with detailed user information
    });
});


    </script>


<!--AWS SDK for javascript-->
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.834.0.min.js"></script>

<!-- <script src="api.js"></script> -->

<script src="../js/main.js"></script>

   

<script>
function logout() {
    localStorage.removeItem("access_token");
    localStorage.removeItem("id_token");
    window.location.href = "http://127.0.0.1:5500/index.html";
}
</script>

<script>
async function fetchUsers() {
    document.getElementById("loading").style.display = "block";
    try {
        const response = await fetch("https://3q516gt0rb.execute-api.us-east-1.amazonaws.com/stage2/admin"); // Replace with actual API endpoint
        const data = await response.json();  // Convert HTTP response to JSON
        
        if (data.body) {
            const users = JSON.parse(data.body);  // Parse the 'body' string
            renderUsers(users);  // Call function to display events
        } else {
            console.error("Unexpected API response format:", data);
        }
    } catch (error) {
        console.error("Error fetching events:", error);
    }
    finally {
            document.getElementById("loading").style.display = "none"; // Hide loading ring
        }
}

const getIST=(created_at)=>{
    const resetDate = new Date(created_at);
    const resetDateIST = new Date(resetDate.getTime() + (5.5 * 60 * 60 * 1000));
    return resetDateIST;
}
function renderUsers(users) {
    const tbody = document.querySelector(".users-table tbody");
    tbody.innerHTML = "";  // Clear existing rows

    users.forEach(user => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${user.name || "N/A"}</td>
            <td>${user.email || "N/A"}</td>
            <td>${user.registeredEvents || 0}</td>
            <td>${getIST(user.created_at) || "N/A"}</td>
            <td>
                <button class="btn-icon" title="View Details" onclick="viewUser('${user.name}', '${user.email}')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

function viewUser(name, email) {
    alert(`User Details:\nName: ${name}\nEmail: ${email}`);
}

// Call fetchUsers on page load
fetchUsers();

</script>
</body>
</html>